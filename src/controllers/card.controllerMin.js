const cardSchema=require("../database/models/cardSchema"),bingoGenerator=require("../model/bingoGeneratorMin");exports.create=async(a,e)=>{try{if(!a.file||!a.file.filename)return e.status(400).json({msg:"Arquivo de imagem n\xe3o recebido ou inv\xe1lido."});let s=a.file.filename,{title:t,category:o,bingosForCards:n,NumberOfCards:r,bingoPattern:i}=a.body;if(!t||!n||!r||!i)return console.log("Informa\xe7\xf5es faltando!"),e.status(400).json({msg:"Informa\xe7\xf5es faltando!"});if("75"!=i&&"100"!=i)return e.status(400).json({msg:"Erro: padr\xe3o de bingo n\xe3o aceito (75 ou 100) "});let d=await bingoGenerator(r,i),c=new cardSchema({title:t,category:o,bingosForCards:n,NumberOfCards:r,bingoPattern:i,background:s,bingoCards:d});return await c.save(),e.status(200).json({msg:"Cartela salva com sucesso!",newCard:c})}catch(u){e.status(500).json({msg:"Erro interno no servidor",error:u})}},exports.getCard=async(a,e)=>{let s=a.params.id,t=await cardSchema.findById(s);e.status(200).json(t)},exports.update=async(a,e)=>{try{let s=a.params.id||"";if(!s)return e.status(400).json({msg:"ID n\xe3o fornecido na consulta."});let{title:t,category:o,bingosForCards:n,NumberOfCards:r,bingoPattern:i}=a.body;if("75"!==i&&"100"!==i)return e.status(400).json({msg:"Erro: padr\xe3o de bingo n\xe3o aceito (75 ou 100)."});let d={title:t,category:o,bingosForCards:n,NumberOfCards:r,bingoPattern:i};a.file&&(d.background=a.file.filename);if((await cardSchema.findById(s)).NumberOfCards!=r){d.bingoCards=[];let c=await bingoGenerator(r,i);d.bingoCards=await c,console.log("Numero de cartelas mudou!, gerando novos Bingos & Cartelas")}let u=await cardSchema.findByIdAndUpdate(s,d,{new:!0});if(!u)return e.status(404).json({msg:"Cartela n\xe3o encontrada."});return e.status(200).json({msg:"Cartela atualizada com sucesso!",updatedCard:u})}catch(m){e.status(500).json({msg:"Erro interno no servidor",error:m})}},exports.delete=async(a,e)=>{try{let s=a.params.id||"";if(!s)return e.status(400).json({msg:"ID n\xe3o fornecido na consulta."});let t=await cardSchema.findByIdAndDelete(s);return e.status(200).json({msg:"Cartela Apagada com sucesso!",deletecard:t})}catch(o){e.status(500).json({msg:"Erro interno no servidor",error:o})}};